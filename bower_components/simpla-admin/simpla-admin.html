<html><head><link rel="import" href="../polymer/polymer.html"></head><body><dom-module id="simpla-admin"><template><style>:host{position:absolute;}:host([hidden]),[hidden]{display:none!important;}</style><simpla-admin-controls editable="[[_editable]]" authenticated="[[_authenticated]]" busy="{{busy}}" on-login="login" on-save="save" hidden$="[[_loginOpen]]"></simpla-admin-controls><simpla-notify></simpla-notify></template><script>!function(){"use strict";function z(a){var b,c=Simpla.getState("buffer");if(b=c&&Object.keys(c).some(function(a){return c[a].modified}))return a.returnValue=q,q}function G(a){a.keyCode===w.edit&&a[k]&&(a.preventDefault(),Simpla.editable(!Simpla.getState("editable")))}function J(a){a.keyCode===w.save&&a[k]&&(a.preventDefault(),document.querySelector("simpla-admin").save())}function K(a){var b=function b(){return!!document.body&&(document.body.appendChild(a),document.removeEventListener("readystatechange",b),!0)};b()||document.addEventListener("readystatechange",b)}function Q(a){var b,c=document.querySelector("simpla-admin");a&&!c&&(b=document.createElement("simpla-admin"),K(b))}function i(){var a=window.location.hash===A;Simpla.editable(a)}function a(a){window.location.hash=a?A:""}function n(a){a.path[0].localName&&"input"===a.path[0].localName||a.preventDefault(),a.stopPropagation()}function o(a){return a&&function(a){return 0===a.indexOf("simpla-")}(a)}function r(a){return!!o(a.localName)||a.getAttribute&&o(a.getAttribute("is"))}function c(a){var b=function(a){return N.includes(a)},c=function(a){return o(a)&&!b(a)};return!!c(a.localName)||c(a.getAttribute&&a.getAttribute("is"))}function l(a){return Array.prototype.filter.call(a,c)}function d(a){return Array.prototype.filter.call(a,r)}function f(a){return Array.prototype.filter.call(a,function(a){return t.has(a)})}function s(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"";a.style.pointerEvents=b}function p(a){s(a,"auto")}function m(a){s(a,"none")}function h(a){s(a,"")}function b(a){t.set(a,0),p(a),j.forEach(function(b){a.addEventListener(b,n)})}function u(a){t.delete(a),h(a),j.forEach(function(b){a.removeEventListener(b,n)})}var g,t,e={properties:{loginPrompt:{type:Boolean,observer:"_toggleLoginPromptObserver"}},_toggleLoginPromptObserver:function(a){var b=this,c=this._simplaObservers,d=function(a){a&&!b._authenticated&&Simpla.login()};return a?(d(Simpla.getState("editable")),void(c.login=Simpla.observeState("editable",d))):void(c.login&&c.login.unobserve())}},q="You have unsaved changes, are you sure you want to leave?",v={attached:function(){window.addEventListener("beforeunload",z)},detached:function(){window.removeEventListener("beforeunload",z)}},k="metaKey",w={edit:69,save:83},y={properties:{hotkeys:Boolean},observers:["_updateEditableListener(_authenticated, hotkeys)","_updateSaveListener(_editable, hotkeys)"],_updateEditableListener:function(a,b){a&&b?document.addEventListener("keydown",G):document.removeEventListener("keydown",G)},_updateSaveListener:function(a,b){a&&b?document.addEventListener("keydown",J):document.removeEventListener("keydown",J)},detached:function(){document.removeEventListener("keydown",G),document.removeEventListener("keydown",J)}},C=function(a,b){return new Promise(function(c,d){b="number"==typeof b?b:20;(function f(){Promise.resolve().then(a).then(function(a){if("boolean"!=typeof a)throw new TypeError("Expected condition to return a boolean");!0===a?c():setTimeout(f,b)}).catch(d)})()})},E={_simplaObservers:[],observe:function(){var a=this;C(function(){return!!window.Simpla},1).then(function(){var b=Simpla.getState(),c=b.editable,d=b.authenticated;Q(c||d),a._simplaObservers=[Simpla.observeState("authenticated",Q),Simpla.observeState("editable",Q)]})},unobserve:function(){this._simplaObservers.forEach(function(a){return a.unobserve()}),this._simplaObservers=[]}},A="#edit",L={_simplaObserver:null,_tracking:!1,track:function(){var b=this;C(function(){return!!window.Simpla},1).then(function(){i(),b._tracking||(window.addEventListener("hashchange",i),a(Simpla.getState("editable")),b._simplaObserver=Simpla.observeState("editable",a),b._tracking=!0)})},untrack:function(){this._tracking&&(window.removeEventListener("hashchange",i),this._simplaObserver&&this._simplaObserver.unobserve(),this._simplaObserver=null,this._tracking=!1)}},B="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},O=function(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")},D=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),x=Object.assign||function(a){for(var b,c=1;c<arguments.length;c++)for(var d in b=arguments[c],b)Object.prototype.hasOwnProperty.call(b,d)&&(a[d]=b[d]);return a},N=["simpla-admin","simpla-login","simpla-admin-controls","simpla-notify"],j=["click","ontouchend"];t=function(){var a;return void 0===B(window.Map)?(a=[],{has:function(b){return-1!==a.indexOf(b)},set:function(b){var c=a.indexOf(b);-1===c&&a.push(b)},delete:function(b){var c=a.indexOf(b);-1!==c&&a.splice(c,1)},forEach:function(b){a.forEach(function(a,c,d){return b.call(d,0,a,c)})}}):new Map}(),g=new MutationObserver(function(a){a.forEach(function(a){l(a.addedNodes).forEach(b),d(a.addedNodes).forEach(p),f(a.removedNodes).forEach(u)})});var H={enable:function(){t.forEach(function(a,b){return u(b)}),g.disconnect(),h(document.body)},disable:function(){var a=document.querySelectorAll("*");l(a).forEach(b),d(a).forEach(p),m(document.body),g.observe(document.body,{childList:!0,subtree:!0})}},M=["../simpla-notify/simpla-notify.html","simpla-admin-controls.html"],F={saved:"changes saved",saveFailed:"something went wrong, try again?"};window.SimplaAdmin=x({},{hashTracking:!0,loginPrompt:!0,hotkeys:!0,protectEditing:!0},window.SimplaAdmin),E.observe(),window.SimplaAdmin.hashTracking&&L.track();var I=function(){function a(){O(this,a)}return D(a,[{key:"beforeRegister",value:function(){this.is="simpla-admin",this.properties={hashTracking:{type:Boolean,observer:"_updateHashTracking"},protectEditing:Boolean,hidden:{type:Boolean,reflectToAttribute:!0},busy:{type:Boolean,value:!1},_editable:Boolean,_authenticated:Boolean,_dependenciesImported:Boolean,_loginOpen:Boolean,_simplaObservers:{type:Object,value:{}}},this.observers=["_toggleHidden(_editable, _authenticated)","_disableEditable(busy)","_updatePointerEvents(protectEditing, _editable)"]}},{key:"ready",value:function(){x(this,window.SimplaAdmin),window.SimplaAdmin=this}},{key:"attached",value:function(){this._importDependencies(),this._syncEditableAndAuthenticated()}},{key:"detached",value:function(){var a=this;Object.keys(this._simplaObservers).forEach(function(b){a._simplaObservers[b].unobserve()}),this._simplaObservers={},L.untrack(),E.unobserve()}},{key:"_disableEditable",value:function(a){a&&Simpla.getState("editable")?(L.untrack(),Simpla.editable(!1),this.__busyDisabled=!0):!a&&this.__busyDisabled&&(Simpla.editable(!0),L.track(),this.__busyDisabled=!1)}},{key:"login",value:function(){3===parseInt(Simpla.version)?Simpla.login():this.$.login.open()}},{key:"save",value:function(){var a=this;this.busy=!0,Simpla.save().then(function(){a.busy=!1,a.fire("simpla-notification",{text:F.saved})}).catch(function(){a.busy=!1,a.fire("simpla-notification",{text:F.saveFailed})})}},{key:"_toggleHidden",value:function(a,b){this.hidden=!a&&!b}},{key:"_updateHashTracking",value:function(a){a?L.track():L.untrack()}},{key:"_updatePointerEvents",value:function(a,b){a&&b?H.disable():H.enable()}},{key:"_syncEditableAndAuthenticated",value:function(){var b=this,c=Simpla.getState(),d=c.editable,e=c.authenticated,f=function(a){return b._editable=a},g=function(a){return b._authenticated=a};f(d),g(e),this._simplaObservers.editable=Simpla.observeState("editable",f),this._simplaObservers.authenticated=Simpla.observeState("authenticated",g)}},{key:"_importDependencies",value:function(){var a=this;M.forEach(function(b){a.importHref(a.resolveUrl(b))})}},{key:"behaviors",get:function(){return[e,y,v]}}]),a}();Polymer(I)}();</script></dom-module></body></html>