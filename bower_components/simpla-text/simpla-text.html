<html><head><link rel="import" href="../polymer/polymer.html"><link rel="import" href="../simpla-element-behavior/simpla-element-behavior.html"></head><body><dom-module id="simpla-text"><template><style>:host{display:block;}:host([contenteditable]){outline:0;}:host([inline]){display:inline;}</style><slot></slot></template><script>!function(){"use strict";var b=document.createElement("simpla-text-toolbar"),c=["simpla-text-toolbar.html","../simpla-richtext-behavior/simpla-richtext-behavior.html"],d=["bold","italic","underline","link"],e={observers:["_checkEditorPrepped(editable, inline)","_updateEditorEditable(editable)"],getEditor:function(){return this._editor},_importEditorDeps:function(){var a=this,b=[];return c.forEach(function(c){b.push(new Promise(function(b,d){a.importHref(a.resolveUrl(c),b,d)}))}),Promise.all(b)},loadEditor:function(){var a=this;return Promise.resolve(this._editor||this._createEditor()).then(function(b){return a._editor=b,b})},runCommand:function(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return this.loadEditor().then(function(c){return c.format(a,b)})},_createEditor:function(){var c=this;return this.__waitForEditor||(this.__waitForEditor=this._importEditorDeps().then(function(){var e,f,g,a=window.SimplaBehaviors.RichText;return e=new a(c,{inline:c.inline,placeholder:c.placeholder,plugins:c.plaintext?[]:d,editable:c.editable,typographer:!c.noTypographer}),f=function(d){var f=d.name,g=d.applied,h=d.meta;b.target===e&&(c._tools=c._tools||{},c._tools[f]={applied:g,meta:h},b.set?(b.set("tools."+f+".active",g),b.set("tools."+f+".meta",h)):(b.tools=b.tools||{},b.tools[f]={applied:g,meta:h}))},g=function(d){var f=d.empty,g=d.native,h=!f&&c.editable&&!c.plaintext;c.fire("select",{selection:g}),b.parentElement!==document.body&&document.body.appendChild(b),b.range=h&&g.rangeCount&&g.getRangeAt(0),c._tools&&(b.tools=c._tools),g&&(b.target=e)},e.on("plugin",f),e.on("select",g),e.on("input",function(){c.__waitForEditor.then(function(){return c.fire("input")})}),c.value&&c.value.trim()&&e.setHTML(c.value),e})),this.__waitForEditor},_updateEditorEditable:function(a){var b=this.getEditor();b&&(b.editable=a)},_checkEditorPrepped:function(a){a&&this.loadEditor()}},f=["h1","h2","h3","h4","h5","h6","p","li","dd","figcaption","mark","q","s","time","u","legend","option","b","big","i","small","tt","abbr","acronym","cite","pre","code","dfn","em","kbd","strong","samp","var","a","span","sub","sup","button","label"],g={properties:{inline:{type:Boolean,reflectToAttribute:!0}},attached:function(){this._autoSetMode()},_autoSetMode:function(){var a=this.parentElement&&this.parentElement.nodeName.toLowerCase();void 0===this.inline&&(this.inline=-1!==f.indexOf(a))}},h=function(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")},a=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i={type:"Text",dataProperties:["value"],setCallback:"_setToSimpla",getCallback:"_getFromSimpla"},j=function(){function b(){h(this,b)}return a(b,[{key:"beforeRegister",value:function(){this.is="simpla-text",this.properties={plaintext:{type:Boolean,value:!1},placeholder:{type:String,value:"Enter your text..."},noTypographer:{type:Boolean,value:!1},active:{type:Boolean,notify:!0,readOnly:!0,value:!1},value:{type:String,observer:"_renderValue"}},this.listeners={tap:"_handleTap",blur:"_handleBlur",focus:"_handleFocus",input:"_refreshValue"}}},{key:"attached",value:function(){this._refreshValue()}},{key:"_handleBlur",value:function(){this._setActive(!1)}},{key:"_handleFocus",value:function(){this.editable&&this._setActive(!0)}},{key:"_handleTap",value:function(){this.editable&&this._setActive(!0)}},{key:"_editableObserver",value:function(a){a||this._setActive(!1)}},{key:"_refreshValue",value:function(){var a=this.getEditor();this.__refreshingValue=!0,this.value=a?a.getHTML():this.innerHTML,this.__refreshingValue=!1}},{key:"_renderValue",value:function(a){var b=this.getEditor();this.__refreshingValue||(b?b.setHTML(a):this.innerHTML=a)}},{key:"_getFromSimpla",value:function(a){a&&a.data&&this.value!==a.data.text&&(this.value=a.data.text)}},{key:"_setToSimpla",value:function(){return{text:this.value}}},{key:"behaviors",get:function(){return[SimplaBehaviors.Element(i),e,g]}}]),b}();Polymer(j)}();</script></dom-module></body></html>