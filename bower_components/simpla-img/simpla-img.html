<html><head><link rel="import" href="../polymer/polymer.html"><link rel="import" href="../simpla-element-behavior/simpla-element-behavior.html"></head><body><dom-module id="simpla-img"><script>!function(){"use strict";var b="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAMAAAACCAQAAAA3fa6RAAAADklEQVR42mNkAANGCAUAACMAA2w/AMgAAAAASUVORK5CYII=",a={width:180,height:130},d=function(a){return a&&0===a.indexOf("data:image")},f=function(a){return!/^https:\/\/storage.googleapis.*simpla/.test(a)},g=function(b){var c=new Image,a=document.createElement("canvas"),d=a.getContext("2d");return c.setAttribute("crossOrigin","anonymous"),new Promise(function(e,f){c.onload=function(){a.width=c.width,a.height=c.height,d.drawImage(c,0,0),e(a.toDataURL("image/png"))},c.onerror=f,c.src=b})},h=Object.assign||function(a){for(var b,c=1;c<arguments.length;c++)for(var d in b=arguments[c],b)Object.prototype.hasOwnProperty.call(b,d)&&(a[d]=b[d]);return a},j=function(){function a(b,c){var d,a=[],f=!0,g=!1;try{for(var h,i=b[Symbol.iterator]();!(f=(h=i.next()).done)&&(a.push(h.value),!c||a.length!==c);f=!0);}catch(a){g=!0,d=a}finally{try{!f&&i.return&&i.return()}finally{if(g)throw d}}return a}return function(b,c){if(Array.isArray(b))return b;if(Symbol.iterator in Object(b))return a(b,c);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),k={editable:{cursor:"pointer",outline:"none"},active:{visibility:"hidden",transition:"visibility",transitionDelay:"50ms"},placeholder:{minHeight:a.height+"px",minWidth:a.width+"px",backgroundSize:"cover",backgroundPosition:"center center",opacity:"0.75"}},c={is:"simpla-img",extends:"img",properties:{src:{type:String,reflectToAttribute:!0,value:function(){return b},notify:!0},alt:{type:String,reflectToAttribute:!0,value:"",notify:!0},placeholder:{type:String,value:""},editable:{type:Boolean,reflectToAttribute:!0,notify:!0,value:!1},active:{type:Boolean,notify:!0,value:!1}},observers:["_importEditor(editable)","_updateEditorImage(active)","_updateEditableUi(editable)","_updateEditingUi(active)","_blurOnInactive(active)","_showPlaceholder(placeholder, editable, src)"],listeners:{tap:"_goActiveIfEditable",focusout:"_maintainFocusWhenActive",blur:"_maintainFocusWhenActive"},behaviors:[SimplaBehaviors.Element({type:"Image",dataProperties:["src","alt"],setCallback:"_updateSimpla"}),{observers:["_ensureIsBase64(src)"],created:function(){this.__staticSrc=this.getAttribute("src")},_ensureIsBase64:function(a){var b=this;this.__staticSrc&&this.__staticSrc===a&&!d(a)&&f(a)&&g(a).then(function(c){a===b.src&&(b.src=c)})}}],_updateEditableUi:function(a){this._toggleStyles(k.editable,a),a?this.setAttribute("tabindex",0):this.removeAttribute("tabindex")},_updateEditingUi:function(a){this._toggleStyles(k.active,a)},_showPlaceholder:function(c,d,e){var f;this.placeholder=this.placeholder||"url("+this.resolveUrl("placeholder.svg")+")",f=h({background:this.placeholder},k.placeholder),this._toggleStyles(f,d&&e===b)},_toggleStyles:function(a,b){var d=this,e=this.__styleCache=this.__styleCache||{};(function(a){return Object.keys(a).map(function(b){return[b,a[b]]})})(a).forEach(function(f){var g=j(f,2),h=g[0],a=g[1],i=e[h],k=d.style[h];b?e[h]=k:(e[h]="",a=i||""),d.style[h]=a})},_updateSimpla:function(){return this.src===b?null:{src:this.src,alt:this.alt}},_goActiveIfEditable:function(){this.editable&&(this.active=!0)},_maintainFocusWhenActive:function(a){var b=document.querySelector("simpla-img-editor");a.relatedTarget===b&&a.stopImmediatePropagation()},_blurOnInactive:function(a){a||(this.fire("focusout"),this.fire("blur",{},{bubbles:!1}))},_updateEditorImage:function(a){var b=document.querySelector("simpla-img-editor");b&&(b.image=a?this:null)},_importEditor:function(a){var b,c=!!document.querySelector("simpla-img-editor");a&&!c&&(this.importHref(this.resolveUrl("simpla-img-editor.html")),b=document.createElement("simpla-img-editor"),document.body.appendChild(b))}};Polymer(c)}();</script></dom-module></body></html>